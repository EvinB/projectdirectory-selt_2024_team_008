document.addEventListener("turbolinks:load",()=>{const e=document.getElementById("convert-button"),t=document.getElementById("buy-button");e&&e.addEventListener("click",()=>{const e=document.getElementById("shard-amount").value,t=document.getElementById("currency-selector").value;fetch("/shard_accounts/convert_currency",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":document.head.querySelector('meta[name="csrf-token"]').content},body:JSON.stringify({amount:e,currency:t})}).then(e=>e.json()).then(e=>{e.converted_amount?document.getElementById("conversion-result").textContent=`Converted Amount: ${e.converted_amount} ${t}`:alert(e.error||"Error converting shards.")})["catch"](e=>{console.error("Error during conversion:",e),alert("An unexpected error occurred.")})}),t&&t.addEventListener("click",()=>{const e=document.getElementById("shard-amount").value,t=document.getElementById("conversion-result").textContent;if(e&&t){const n=t.split(": ")[1];fetch("/shard_accounts/has_card",{method:"GET",headers:{"Content-Type":"application/json","X-CSRF-Token":document.head.querySelector('meta[name="csrf-token"]').content}}).then(e=>e.json()).then(t=>{t.has_card?confirm(`Are you sure you want to buy ${e} Shards for ${n}?`)&&fetch("/shard_accounts/add_funds",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":document.head.querySelector('meta[name="csrf-token"]').content,"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({amount:e,currency:"USD"})}).then(e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()}).then(t=>{if(t.success){alert(`Successfully purchased ${e} Shards!`);const n=document.querySelector(".shard-balance-display");n&&(n.textContent=`Shard Balance: ${t.new_balance} Shards`)}else alert(t.error||"Error completing purchase.")})["catch"](e=>{console.error("Error during purchase:",e),alert("An unexpected error occurred during the purchase.")}):alert("Please add a payment method to purchase Shards.")})["catch"](e=>{console.error("Error checking payment method:",e),alert("An unexpected error occurred while verifying payment methods.")})}else alert("Please enter a valid amount and perform the conversion first.")})});