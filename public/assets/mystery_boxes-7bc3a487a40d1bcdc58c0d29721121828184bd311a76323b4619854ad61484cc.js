document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("open-case-btn"),t=document.getElementById("box-opening-video"),n=document.getElementById("box-image"),o=document.getElementById("item-reveal"),s=document.getElementById("item-name"),l=document.getElementById("mystery-box-count");e&&t&&n?e.addEventListener("click",()=>{e.style.display="none",n.style.display="none",t.style.display="block",t.play(),fetch("/mystery_boxes/open_box",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}}).then(e=>e.json()).then(d=>{d.success?(o.style.display="none",t.onended=(()=>{t.style.display="none",n.src=d.item_image_url,n.style.display="block",s.textContent=`You got: ${d.item_name}`,o.style.display="block",l&&(l.textContent=d.remaining_boxes),e.disabled=!1,e.style.display="block"})):(alert(d.message),e.disabled=!1,e.style.display="block")})["catch"](t=>{console.error("Error opening box:",t),e.disabled=!1,e.style.display="block"})}):console.warn("Required mystery box elements are missing. Initialization skipped.")});